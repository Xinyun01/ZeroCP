# Unix Domain Socket é€šä¿¡æµç¨‹è¯¦è§£

## ğŸ”„ å®Œæ•´æµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Unix Domain Socket è¿›ç¨‹é—´é€šä¿¡æµç¨‹                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                           åˆå§‹åŒ–é˜¶æ®µ
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

æœåŠ¡ç«¯                                              å®¢æˆ·ç«¯
  â”‚                                                   â”‚
  â”‚  1ï¸âƒ£ socket(AF_UNIX, SOCK_STREAM, 0)              â”‚
  â”œâ”€â”€â”€â”€â–º åˆ›å»º socket æ–‡ä»¶æè¿°ç¬¦                       â”‚
  â”‚      è¿”å›: fd = 3                                 â”‚
  â”‚                                                   â”‚
  â”‚  2ï¸âƒ£ bind(fd, &addr, len)                          â”‚
  â”œâ”€â”€â”€â”€â–º ç»‘å®šåˆ°æ–‡ä»¶ç³»ç»Ÿè·¯å¾„                           â”‚
  â”‚      addr.sun_path = "/tmp/my.sock"              â”‚
  â”‚      åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­åˆ›å»º socket æ–‡ä»¶                  â”‚
  â”‚                                                   â”‚
  â”‚  3ï¸âƒ£ listen(fd, backlog)                           â”‚
  â”œâ”€â”€â”€â”€â–º å¼€å§‹ç›‘å¬è¿æ¥è¯·æ±‚                             â”‚
  â”‚      è®¾ç½®ç­‰å¾…é˜Ÿåˆ—é•¿åº¦ = 10                         â”‚
  â”‚                                                   â”‚
  â–¼                                                   â”‚
å‡†å¤‡å®Œæˆ                                              â”‚
ç­‰å¾…è¿æ¥...                                           â”‚
  â”‚                                                   â”‚

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                          è¿æ¥å»ºç«‹é˜¶æ®µ
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  â”‚                                                   â”‚
  â”‚                                      1ï¸âƒ£ socket(AF_UNIX, SOCK_STREAM, 0)
  â”‚                                      â”œâ”€â”€â”€â”€â–º åˆ›å»ºå®¢æˆ·ç«¯ socket
  â”‚                                      â”‚      è¿”å›: fd = 4
  â”‚                                      â”‚
  â”‚                                      2ï¸âƒ£ connect(fd, &addr, len)
  â”‚  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€è¿æ¥è¯·æ±‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                                      â”‚
  4ï¸âƒ£ accept(server_fd, NULL, NULL)        â”‚
  â”œâ”€â”€â”€â”€â–º æ¥å—è¿æ¥è¯·æ±‚                    â”‚
  â”‚      è¿”å›: client_fd = 5             â”‚
  â”‚                                      â”‚
  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€è¿æ¥æˆåŠŸâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
  â”‚                                      â”‚
  â–¼                                      â–¼
è¿æ¥å»ºç«‹                                è¿æ¥å»ºç«‹
client_fd = 5                          fd = 4

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                          æ•°æ®ä¼ è¾“é˜¶æ®µ
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  â”‚                                      â”‚
  â”‚  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€æ•°æ®åŒ… "Hello"â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ 5ï¸âƒ£ send(fd, "Hello", 5, 0)
  â”‚                                      â”‚
  5ï¸âƒ£ recv(client_fd, buffer, 256, 0)     â”‚
  â”œâ”€â”€â”€â”€â–º æ¥æ”¶æ•°æ®                        â”‚
  â”‚      buffer = "Hello"                â”‚
  â”‚      è¿”å›: 5 å­—èŠ‚                     â”‚
  â”‚                                      â”‚
  â”‚  å¤„ç†æ•°æ®...                          â”‚
  â”‚  ç”Ÿæˆå“åº” "World"                     â”‚
  â”‚                                      â”‚
  6ï¸âƒ£ send(client_fd, "World", 5, 0)      â”‚
  â”œâ”€â”€â”€â”€â–º å‘é€å“åº”                        â”‚
  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€æ•°æ®åŒ… "World"â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
  â”‚                                      â”‚
  â”‚                                      6ï¸âƒ£ recv(fd, buffer, 256, 0)
  â”‚                                      â”œâ”€â”€â”€â”€â–º æ¥æ”¶å“åº”
  â”‚                                      â”‚      buffer = "World"
  â”‚                                      â”‚      è¿”å›: 5 å­—èŠ‚
  â”‚                                      â”‚

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                          è¿æ¥å…³é—­é˜¶æ®µ
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  â”‚                                      â”‚
  â”‚                                      7ï¸âƒ£ close(fd)
  â”‚  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€å…³é—­è¿æ¥â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                                      â”‚
  7ï¸âƒ£ close(client_fd)                    â”‚
  â”œâ”€â”€â”€â”€â–º å…³é—­å®¢æˆ·ç«¯è¿æ¥                  â”‚
  â”‚      é‡Šæ”¾ fd = 5                      â”‚
  â”‚                                      â–¼
  â”‚                                    è¿æ¥å…³é—­
  â”‚
  8ï¸âƒ£ close(server_fd)
  â”œâ”€â”€â”€â”€â–º å…³é—­æœåŠ¡ç«¯ socket
  â”‚      é‡Šæ”¾ fd = 3
  â”‚
  9ï¸âƒ£ unlink("/tmp/my.sock")
  â”œâ”€â”€â”€â”€â–º åˆ é™¤ socket æ–‡ä»¶
  â”‚
  â–¼
æ¸…ç†å®Œæˆ
```

## ğŸ“Š Linux å†…æ ¸å±‚é¢çš„å·¥ä½œæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Linux å†…æ ¸å¤„ç†æµç¨‹                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç”¨æˆ·ç©ºé—´                   å†…æ ¸ç©ºé—´                    æ–‡ä»¶ç³»ç»Ÿ
   â”‚                         â”‚                           â”‚
   â”‚  socket()               â”‚                           â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º   â”‚                           â”‚
   â”‚                      åˆ›å»º socket å¯¹è±¡                â”‚
   â”‚                      åˆ†é…å†…æ ¸ç¼“å†²åŒº                  â”‚
   â”‚  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                           â”‚
   â”‚  è¿”å› fd               â”‚                           â”‚
   â”‚                         â”‚                           â”‚
   â”‚  bind()                 â”‚                           â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º   â”‚                           â”‚
   â”‚                      åˆ›å»º VFS inode                  â”‚
   â”‚                         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
   â”‚                         â”‚                      åˆ›å»º socket æ–‡ä»¶
   â”‚  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                           â”‚
   â”‚  ç»‘å®šæˆåŠŸ               â”‚                           â”‚
   â”‚                         â”‚                           â”‚
   â”‚  listen()               â”‚                           â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º   â”‚                           â”‚
   â”‚                      è®¾ç½® socket çŠ¶æ€ä¸º LISTEN       â”‚
   â”‚                      åˆå§‹åŒ–è¿æ¥é˜Ÿåˆ—                  â”‚
   â”‚  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                           â”‚
   â”‚                         â”‚                           â”‚
   â”‚  accept() [é˜»å¡]        â”‚                           â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º   â”‚                           â”‚
   â”‚                      ç­‰å¾…è¿æ¥é˜Ÿåˆ—...                â”‚
   â”‚                         â”‚                           â”‚

                        [å®¢æˆ·ç«¯å‘èµ·è¿æ¥]

   â”‚                         â”‚                           â”‚
   â”‚                      æ£€æµ‹åˆ°è¿æ¥è¯·æ±‚                 â”‚
   â”‚                      åˆ›å»ºæ–°çš„ socket                â”‚
   â”‚                      ä¸‰æ¬¡æ¡æ‰‹ï¼ˆå†…éƒ¨ï¼‰               â”‚
   â”‚  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                           â”‚
   â”‚  è¿”å›æ–° fd             â”‚                           â”‚
   â”‚                         â”‚                           â”‚
   â”‚  send()/recv()          â”‚                           â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º   â”‚                           â”‚
   â”‚                      æ•°æ®æ‹·è´åˆ°å†…æ ¸ç¼“å†²åŒº            â”‚
   â”‚                      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
   â”‚                      â”‚  å‘é€ç¼“å†²åŒº   â”‚               â”‚
   â”‚                      â”‚  æ¥æ”¶ç¼“å†²åŒº   â”‚               â”‚
   â”‚                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
   â”‚                      é€šè¿‡å†…æ ¸ä¼ è¾“æ•°æ®                â”‚
   â”‚  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                           â”‚
   â”‚                         â”‚                           â”‚
   â”‚  close()                â”‚                           â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º   â”‚                           â”‚
   â”‚                      é‡Šæ”¾ socket èµ„æº                â”‚
   â”‚                      æ¸…ç†å†…æ ¸ç¼“å†²åŒº                  â”‚
   â”‚                         â”‚                           â”‚
   â”‚  unlink()               â”‚                           â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º   â”‚                           â”‚
   â”‚                         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
   â”‚                         â”‚                      åˆ é™¤ socket æ–‡ä»¶
   â”‚  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                           â”‚
   â”‚                         â”‚                           â”‚
```

## ğŸ” ç³»ç»Ÿè°ƒç”¨è¯¦è§£

### 1. socket() ç³»ç»Ÿè°ƒç”¨

```c
int socket(int domain, int type, int protocol);
```

**å‚æ•°**:
- `domain`: AF_UNIX (æœ¬åœ°é€šä¿¡)
- `type`: SOCK_STREAM (å¯é æµ) æˆ– SOCK_DGRAM (æ•°æ®æŠ¥)
- `protocol`: 0 (è‡ªåŠ¨é€‰æ‹©)

**å†…æ ¸æ“ä½œ**:
1. åˆ†é… `struct socket` å¯¹è±¡
2. åˆ†é…å‘é€å’Œæ¥æ”¶ç¼“å†²åŒº
3. åˆå§‹åŒ– socket çŠ¶æ€
4. è¿”å›æ–‡ä»¶æè¿°ç¬¦

**è¿”å›å€¼**: æˆåŠŸè¿”å› fdï¼Œå¤±è´¥è¿”å› -1

---

### 2. bind() ç³»ç»Ÿè°ƒç”¨

```c
int bind(int sockfd, const struct sockaddr *addr, socklen_t addrlen);
```

**å‚æ•°**:
- `sockfd`: socket æ–‡ä»¶æè¿°ç¬¦
- `addr`: æŒ‡å‘ `struct sockaddr_un` çš„æŒ‡é’ˆ
- `addrlen`: åœ°å€ç»“æ„å¤§å°

**å†…æ ¸æ“ä½œ**:
1. éªŒè¯è·¯å¾„æœ‰æ•ˆæ€§ï¼ˆé•¿åº¦ < 108ï¼‰
2. åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­åˆ›å»º socket æ–‡ä»¶
3. å°† socket ä¸è·¯å¾„å…³è”
4. è®¾ç½®æ–‡ä»¶æƒé™

**è¿”å›å€¼**: æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1

---

### 3. listen() ç³»ç»Ÿè°ƒç”¨

```c
int listen(int sockfd, int backlog);
```

**å‚æ•°**:
- `sockfd`: socket æ–‡ä»¶æè¿°ç¬¦
- `backlog`: ç­‰å¾…é˜Ÿåˆ—çš„æœ€å¤§é•¿åº¦

**å†…æ ¸æ“ä½œ**:
1. å°† socket çŠ¶æ€è®¾ç½®ä¸º LISTEN
2. åˆå§‹åŒ–è¿æ¥é˜Ÿåˆ—ï¼ˆå·²å®Œæˆé˜Ÿåˆ— + æœªå®Œæˆé˜Ÿåˆ—ï¼‰
3. å‡†å¤‡æ¥å—è¿æ¥è¯·æ±‚

**è¿”å›å€¼**: æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1

---

### 4. accept() ç³»ç»Ÿè°ƒç”¨

```c
int accept(int sockfd, struct sockaddr *addr, socklen_t *addrlen);
```

**å‚æ•°**:
- `sockfd`: ç›‘å¬ socket çš„æ–‡ä»¶æè¿°ç¬¦
- `addr`: ç”¨äºå­˜å‚¨å®¢æˆ·ç«¯åœ°å€ï¼ˆå¯ä»¥ä¸º NULLï¼‰
- `addrlen`: åœ°å€ç»“æ„å¤§å°

**å†…æ ¸æ“ä½œ**:
1. æ£€æŸ¥è¿æ¥é˜Ÿåˆ—
2. å¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œé˜»å¡ç­‰å¾…
3. ä»é˜Ÿåˆ—ä¸­å–å‡ºä¸€ä¸ªè¿æ¥
4. åˆ›å»ºæ–°çš„ socket å¯¹è±¡
5. è¿”å›æ–°çš„æ–‡ä»¶æè¿°ç¬¦

**è¿”å›å€¼**: æˆåŠŸè¿”å›æ–°è¿æ¥çš„ fdï¼Œå¤±è´¥è¿”å› -1

---

### 5. connect() ç³»ç»Ÿè°ƒç”¨

```c
int connect(int sockfd, const struct sockaddr *addr, socklen_t addrlen);
```

**å‚æ•°**:
- `sockfd`: å®¢æˆ·ç«¯ socket æ–‡ä»¶æè¿°ç¬¦
- `addr`: æœåŠ¡ç«¯åœ°å€
- `addrlen`: åœ°å€ç»“æ„å¤§å°

**å†…æ ¸æ“ä½œ**:
1. æŸ¥æ‰¾æœåŠ¡ç«¯ socket
2. å‘é€è¿æ¥è¯·æ±‚åˆ°æœåŠ¡ç«¯çš„è¿æ¥é˜Ÿåˆ—
3. ç­‰å¾…æœåŠ¡ç«¯ accept
4. å»ºç«‹è¿æ¥

**è¿”å›å€¼**: æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1

---

### 6. send() ç³»ç»Ÿè°ƒç”¨

```c
ssize_t send(int sockfd, const void *buf, size_t len, int flags);
```

**å‚æ•°**:
- `sockfd`: socket æ–‡ä»¶æè¿°ç¬¦
- `buf`: è¦å‘é€çš„æ•°æ®
- `len`: æ•°æ®é•¿åº¦
- `flags`: æ ‡å¿—ä½ï¼ˆé€šå¸¸ä¸º 0ï¼‰

**å†…æ ¸æ“ä½œ**:
1. å°†æ•°æ®ä»ç”¨æˆ·ç©ºé—´æ‹·è´åˆ°å†…æ ¸å‘é€ç¼“å†²åŒº
2. ä¼ è¾“æ•°æ®åˆ°å¯¹ç«¯çš„æ¥æ”¶ç¼“å†²åŒº
3. å¦‚æœç¼“å†²åŒºæ»¡ï¼Œå¯èƒ½é˜»å¡

**è¿”å›å€¼**: æˆåŠŸè¿”å›å‘é€çš„å­—èŠ‚æ•°ï¼Œå¤±è´¥è¿”å› -1

---

### 7. recv() ç³»ç»Ÿè°ƒç”¨

```c
ssize_t recv(int sockfd, void *buf, size_t len, int flags);
```

**å‚æ•°**:
- `sockfd`: socket æ–‡ä»¶æè¿°ç¬¦
- `buf`: æ¥æ”¶ç¼“å†²åŒº
- `len`: ç¼“å†²åŒºå¤§å°
- `flags`: æ ‡å¿—ä½ï¼ˆé€šå¸¸ä¸º 0ï¼‰

**å†…æ ¸æ“ä½œ**:
1. ä»å†…æ ¸æ¥æ”¶ç¼“å†²åŒºè¯»å–æ•°æ®
2. å°†æ•°æ®æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´
3. å¦‚æœç¼“å†²åŒºç©ºï¼Œå¯èƒ½é˜»å¡

**è¿”å›å€¼**: æˆåŠŸè¿”å›æ¥æ”¶çš„å­—èŠ‚æ•°ï¼Œè¿æ¥å…³é—­è¿”å› 0ï¼Œå¤±è´¥è¿”å› -1

---

### 8. close() ç³»ç»Ÿè°ƒç”¨

```c
int close(int fd);
```

**å†…æ ¸æ“ä½œ**:
1. å‡å°‘æ–‡ä»¶æè¿°ç¬¦å¼•ç”¨è®¡æ•°
2. å¦‚æœå¼•ç”¨è®¡æ•°ä¸º 0ï¼Œé‡Šæ”¾èµ„æº
3. æ¸…ç†å†…æ ¸ç¼“å†²åŒº
4. é€šçŸ¥å¯¹ç«¯è¿æ¥å…³é—­

**è¿”å›å€¼**: æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1

---

### 9. unlink() ç³»ç»Ÿè°ƒç”¨

```c
int unlink(const char *pathname);
```

**å†…æ ¸æ“ä½œ**:
1. ä»æ–‡ä»¶ç³»ç»Ÿä¸­åˆ é™¤æŒ‡å®šæ–‡ä»¶
2. å¦‚æœæ²¡æœ‰è¿›ç¨‹æ‰“å¼€è¯¥æ–‡ä»¶ï¼Œç«‹å³åˆ é™¤
3. å¦åˆ™ç­‰åˆ°æœ€åä¸€ä¸ªè¿›ç¨‹å…³é—­æ–‡ä»¶

**è¿”å›å€¼**: æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1

## ğŸ“ˆ æ•°æ®ä¼ è¾“åŸç†

### å†…æ ¸ç¼“å†²åŒºæœºåˆ¶

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ•°æ®ä¼ è¾“ç¤ºæ„å›¾                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

è¿›ç¨‹ A (å‘é€æ–¹)            å†…æ ¸ç©ºé—´              è¿›ç¨‹ B (æ¥æ”¶æ–¹)
     â”‚                       â”‚                        â”‚
     â”‚  send(data)           â”‚                        â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º    â”‚                        â”‚
     â”‚                  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”                 â”‚
     â”‚                  â”‚  å‘é€ç¼“å†²åŒº â”‚                 â”‚
     â”‚                  â”‚ [4K-64K]  â”‚                 â”‚
     â”‚                  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                 â”‚
     â”‚                       â”‚                        â”‚
     â”‚                  å†…æ ¸ä¼ è¾“                      â”‚
     â”‚                   (é›¶æ‹·è´)                     â”‚
     â”‚                       â”‚                        â”‚
     â”‚                  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”                 â”‚
     â”‚                  â”‚  æ¥æ”¶ç¼“å†²åŒº â”‚                 â”‚
     â”‚                  â”‚ [4K-64K]  â”‚                 â”‚
     â”‚                  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                 â”‚
     â”‚                       â”‚                        â”‚
     â”‚                       â”‚  recv(buffer)          â”‚
     â”‚                       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º    â”‚
     â”‚                       â”‚                        â–¼
     â”‚                       â”‚                   buffer[]

ç‰¹ç‚¹:
âœ… æ•°æ®åªåœ¨å†…æ ¸ç©ºé—´ä¼ è¾“
âœ… é¿å…ç½‘ç»œåè®®æ ˆå¼€é”€
âœ… é«˜æ•ˆçš„é›¶æ‹·è´ä¼ è¾“
```

## ğŸ” å®‰å…¨æœºåˆ¶

### æ–‡ä»¶æƒé™æ§åˆ¶

```bash
# socket æ–‡ä»¶çš„æƒé™ç¤ºä¾‹
$ ls -l /tmp/*.sock
srwxr-xr-x 1 user group 0 Oct 20 10:30 /tmp/my.sock
â”‚â”‚â”‚â”‚â”‚â”‚â”‚â”‚â”‚
â”‚â”‚â”‚â”‚â”‚â”‚â”‚â”‚â””â”€ å…¶ä»–ç”¨æˆ·: å¯æ‰§è¡Œ
â”‚â”‚â”‚â”‚â”‚â”‚â”‚â””â”€â”€ å…¶ä»–ç”¨æˆ·: å¯è¯»
â”‚â”‚â”‚â”‚â”‚â”‚â””â”€â”€â”€ å…¶ä»–ç”¨æˆ·: å¯å†™
â”‚â”‚â”‚â”‚â”‚â””â”€â”€â”€â”€ ç»„: å¯æ‰§è¡Œ
â”‚â”‚â”‚â”‚â””â”€â”€â”€â”€â”€ ç»„: å¯è¯»
â”‚â”‚â”‚â””â”€â”€â”€â”€â”€â”€ ç»„: å¯å†™
â”‚â”‚â””â”€â”€â”€â”€â”€â”€â”€ æ‰€æœ‰è€…: å¯æ‰§è¡Œ
â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€ æ‰€æœ‰è€…: å¯è¯»
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€ æ‰€æœ‰è€…: å¯å†™

s = socket æ–‡ä»¶ç±»å‹
```

### æƒé™è®¾ç½®

```cpp
// ä»…æ‰€æœ‰è€…å¯è®¿é—® (0700)
.filePermissions(Perms::OwnerAll)

// æ‰€æœ‰è€…è¯»å†™ (0600)
.filePermissions(Perms::OwnerRead | Perms::OwnerWrite)

// æ‰€æœ‰ç”¨æˆ·éƒ½å¯è®¿é—® (0777)
.filePermissions(Perms::All)
```

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. é”™è¯¯å¤„ç†

```cpp
auto result = UnixDomainSocketBuilder()
    .path("/tmp/my.sock")
    .createServer();

if (!result)
{
    // å¤„ç†é”™è¯¯
    switch (result.error())
    {
        case UnixDomainSocketError::PATH_TOO_LONG:
            // è·¯å¾„å¤ªé•¿
            break;
        case UnixDomainSocketError::BIND_FAILED:
            // ç»‘å®šå¤±è´¥ï¼Œå¯èƒ½æƒé™ä¸è¶³æˆ–è·¯å¾„å·²è¢«å ç”¨
            break;
        // ... å…¶ä»–é”™è¯¯
    }
    return;
}
```

### 2. èµ„æºæ¸…ç†

```cpp
{
    auto server = UnixDomainSocketBuilder()
        .path("/tmp/my.sock")
        .createServer();
    
    // ... ä½¿ç”¨ server ...
    
}  // ç¦»å¼€ä½œç”¨åŸŸæ—¶è‡ªåŠ¨æ¸…ç†ï¼ˆRAIIï¼‰
   // - å…³é—­æ–‡ä»¶æè¿°ç¬¦
   // - åˆ é™¤ socket æ–‡ä»¶
```

### 3. å®Œæ•´çš„æ•°æ®ä¼ è¾“

```cpp
// å®Œæ•´å‘é€å‡½æ•°
bool sendAll(UnixDomainSocket& socket, const void* data, size_t size)
{
    size_t totalSent = 0;
    const char* ptr = static_cast<const char*>(data);
    
    while (totalSent < size)
    {
        ssize_t sent = socket.send(ptr + totalSent, size - totalSent);
        if (sent <= 0)
        {
            return false;  // å‘é€å¤±è´¥
        }
        totalSent += sent;
    }
    
    return true;
}

// å®Œæ•´æ¥æ”¶å‡½æ•°
bool recvAll(UnixDomainSocket& socket, void* buffer, size_t size)
{
    size_t totalReceived = 0;
    char* ptr = static_cast<char*>(buffer);
    
    while (totalReceived < size)
    {
        ssize_t received = socket.receive(ptr + totalReceived, 
                                          size - totalReceived);
        if (received <= 0)
        {
            return false;  // æ¥æ”¶å¤±è´¥æˆ–è¿æ¥å…³é—­
        }
        totalReceived += received;
    }
    
    return true;
}
```

### 4. è¶…æ—¶å¤„ç†

```cpp
#include <sys/socket.h>
#include <sys/time.h>

void setSocketTimeout(int fd, int seconds)
{
    struct timeval timeout;
    timeout.tv_sec = seconds;
    timeout.tv_usec = 0;
    
    // è®¾ç½®æ¥æ”¶è¶…æ—¶
    setsockopt(fd, SOL_SOCKET, SO_RCVTIMEO, &timeout, sizeof(timeout));
    
    // è®¾ç½®å‘é€è¶…æ—¶
    setsockopt(fd, SOL_SOCKET, SO_SNDTIMEO, &timeout, sizeof(timeout));
}

// ä½¿ç”¨
auto socket = builder.createClient().value();
setSocketTimeout(socket.getFileDescriptor(), 5);  // 5ç§’è¶…æ—¶
```

---

**ç›¸å…³æ–‡æ¡£**:
- [è¯¦ç»†ä½¿ç”¨æŒ‡å—](../test/posix/ipc/UNIX_DOMAIN_SOCKET_GUIDE.md)
- [API æ–‡æ¡£](../zerocp_foundationLib/posix/ipc/include/unix_domainsocket.hpp)
- [æµ‹è¯•ä»£ç ](../test/posix/ipc/test_unix_domainsocket.cpp)

