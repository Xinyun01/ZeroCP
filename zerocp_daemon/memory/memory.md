## 一、完整的内存布局图

```
┌─────────────────────────────────────────────────────────────────┐
│  共享内存 #1: 管理段 (/iox_mgmt)                                 │
│  总大小 = requiredManagementMemorySize()                         │
└─────────────────────────────────────────────────────────────────┘

第1部分：MemoryManager 对象本身
┌─────────────────────────────────────────────────────────────────┐
│ MemoryManager 对象（约 500 字节）                                │
│ ├─ m_memPoolVector: vector<MemPool, 32>                         │
│ │   ├─ m_size: 3                                                │
│ │   └─ m_data[32]:                                              │
│ │       ├─ [0] MemPool 对象（约 100 字节）← 管理 128B 池         │
│ │       ├─ [1] MemPool 对象（约 100 字节）← 管理 256B 池         │
│ │       ├─ [2] MemPool 对象（约 100 字节）← 管理 1024B 池        │
│ │       └─ [3..31] 未使用                                       │
│ ├─ m_chunkManagementPool: vector<MemPool, 1>                    │
│ │   └─ [0] MemPool 对象（约 100 字节）← 管理 ChunkManagement 池 │
│ └─ m_totalNumberOfChunks: 170                                   │
└─────────────────────────────────────────────────────────────────┘
         大小 = sizeof(MemoryManager) ≈ 500 字节

第2部分：每个数据池的静态链表（索引数组）
┌─────────────────────────────────────────────────────────────────┐
│ MemPool[0] 的索引数组（100 个索引）                              │
│ ├─ uint32_t indices[100] = {0, 1, 2, ..., 99}                   │
│ └─ 头指针等元数据                                                │
│ 大小 = LoFFLi::requiredIndexMemorySize(100) ≈ 400 字节          │
├─────────────────────────────────────────────────────────────────┤
│ MemPool[1] 的索引数组（50 个索引）                               │
│ ├─ uint32_t indices[50] = {0, 1, 2, ..., 49}                    │
│ └─ 头指针等元数据                                                │
│ 大小 = LoFFLi::requiredIndexMemorySize(50) ≈ 200 字节           │
├─────────────────────────────────────────────────────────────────┤
│ MemPool[2] 的索引数组（20 个索引）                               │
│ ├─ uint32_t indices[20] = {0, 1, 2, ..., 19}                    │
│ └─ 头指针等元数据                                                │
│ 大小 = LoFFLi::requiredIndexMemorySize(20) ≈ 80 字节            │
└─────────────────────────────────────────────────────────────────┘
         总大小 ≈ 680 字节（对齐后）

第3部分：chunkManagementPool 的静态链表（索引数组）
┌─────────────────────────────────────────────────────────────────┐
│ chunkManagementPool[0] 的索引数组（170 个索引）                  │
│ ├─ uint32_t indices[170] = {0, 1, 2, ..., 169}                  │
│ └─ 头指针等元数据                                                │
│ 大小 = LoFFLi::requiredIndexMemorySize(170) ≈ 680 字节          │
└─────────────────────────────────────────────────────────────────┘
         大小 ≈ 680 字节（对齐后）

第4部分：ChunkManagement 对象数组
┌─────────────────────────────────────────────────────────────────┐
│ ChunkManagement 对象数组（170 个对象）                           │
│ ├─ [0] ChunkManagement (56 字节)                                │
│ │   ├─ m_chunkHeader: RelativePointer                           │
│ │   ├─ m_referenceCounter: Atomic<uint64_t>                     │
│ │   ├─ m_mempool: RelativePointer                               │
│ │   └─ m_chunkManagementPool: RelativePointer                   │
│ ├─ [1] ChunkManagement (56 字节)                                │
│ ├─ [2] ChunkManagement (56 字节)                                │
│ └─ ...                                                          │
│     [169] ChunkManagement (56 字节)                             │
│ 大小 = 170 × sizeof(ChunkManagement) = 170 × 56 ≈ 9520 字节    │
└─────────────────────────────────────────────────────────────────┘
         大小 ≈ 9520 字节（对齐后）

┌─────────────────────────────────────────────────────────────────┐
│ 管理区总大小 ≈ 500 + 680 + 680 + 9520 ≈ 11.4 KB                 │
└─────────────────────────────────────────────────────────────────┘


### 数据段内存（/iox_publisher_group）

```
地址：0x7f0100000000
大小：约 150 KB

┌─────────────────────────────────────────────────────────────────┐
│ 池0的 Chunk 数组（128 字节 × 100）= 12,800 字节                   │
│ ─────────────────────────────────────────────────────────────── │
│ 0x7f0100000000: Chunk[0]                                        │
│   ├─ ChunkHeader (48 字节)                                       │
│   │   ├─ m_chunkSize: 128                                       │
│   │   ├─ m_userPayloadSize: 80                                  │
│   │   └─ m_userPayloadOffset: 48                                │
│   └─ User-Payload (80 字节)                                      │
│ 0x7f0100000080: Chunk[1]                                        │
│ 0x7f0100000100: Chunk[2]                                        │
│ ...                                                             │
│ 0x7f0100003180: Chunk[99]                                       │
├─────────────────────────────────────────────────────────────────┤
│ 池1的 Chunk 数组（1024 字节 × 50）= 51,200 字节                  │
│ ─────────────────────────────────────────────────────────────── │
│ 0x7f0100003200: Chunk[0]                                        │
│   ├─ ChunkHeader (48 字节)                                       │
│   │   ├─ m_chunkSize: 1024                                      │
│   │   ├─ m_userPayloadSize: 976                                 │
│   │   └─ m_userPayloadOffset: 48                                │
│   └─ User-Payload (976 字节)                                     │
│ 0x7f0100003600: Chunk[1]                                        │
│ ...                                                             │
│ 0x7f010000e600: Chunk[49]                                       │
├─────────────────────────────────────────────────────────────────┤
│ 池2的 Chunk 数组（4096 字节 × 20）= 81,920 字节                  │
│ ─────────────────────────────────────────────────────────────── │
│ 0x7f010000e800: Chunk[0]                                        │
│   ├─ ChunkHeader (48 字节)                                       │
│   │   ├─ m_chunkSize: 4096                                      │
│   │   ├─ m_userPayloadSize: 4048                                │
│   │   └─ m_userPayloadOffset: 48                                │
│   └─ User-Payload (4048 字节)                                    │
│ 0x7f010000f800: Chunk[1]                                        │
│ ...                                                             │
│ 0x7f0100022800: Chunk[19]                                       │
└─────────────────────────────────────────────────────────────────